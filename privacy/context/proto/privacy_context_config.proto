syntax = "editions";

package privacy.context;

import "dataresidency/mapping/cloud/cloud_locations_enum.proto";
import "net/proto2/bridge/proto/message_set.proto";
import "privacy/ads/user_data_enforcement/data-usage.proto";
import "privacy/context/proto/approved_attribute.proto";
import "privacy/context/proto/policy_breakglass.proto";
import "privacy/data_flow/job_level_sensor/proto/propagated_product_id_setter_metadata.proto";
import "privacy/data_flow/job_level_sensor/proto/semantic_purpose_setter_metadata.proto";
import "privacy/data_governance/attributes/proto/ddt.proto";
import "privacy/data_governance/attributes/proto/purpose.proto";
import "privacy/pattributes/public/proto/semantic_purpose.proto";
import "privacy/ptoken/public/core/logical_policy.proto";
import "privacy/ptoken/public/core/request_context_defs.proto";
import "production/machine_locality/proto/machine_locality_public.proto";

option java_multiple_files = true;
option java_package = "com.google.privacy.context";

message PrivacyContextDefaultConfig {
    optional Source source = 1;
    enum Source {
        SOURCE_UNSPECIFIED = 0;
        CONFIG_API = 1;
        INTRINSIC = 50;
        ENV_ROLE_DEFAULT = 100;
        ENV_JOB_DEFAULT = 200;
        ENV_PRIVACY_CONTEXT_PORTABILITY = 300;
        FLAG_OVERRIDE = 999;
        DYNAMIC = 2001;
    }
    
    optional int32 origin_product_id = 2;
    optional Source origin_product_id_source = 18;
    repeated .ptoken.PolicyRolloutEnforcementMode request_policy_global_rampup = 12;
    optional Source request_policy_global_rampup_source = 19;
    optional bool request_policy_dma52_global_rampup_override = 16;
    optional Source request_policy_dma52_global_rampup_override_source = 20;
    optional data_governance.attributes.DDTContext ddt_context = 13;
    optional Source ddt_context_source = 21;
    optional bool dma52_cross_use_offered_together = 4;
    optional Source dma52_cross_use_offered_together_source = 22;
    optional .ptoken.Dma52ProcessingType dma52_processing_type = 6;
    optional Source dma52_processing_type_source = 23;
    optional bool post_access_filtering = 8;
    optional Source post_access_filtering_source = 24;
    repeated data_governance.attributes.ProcessingPurpose.Purpose processing_purpose = 3;
    repeated ApprovedAttribute approved_processing_purposes = 56;
    optional Source processing_purpose_source = 25;
    optional .pattributes.SemanticPurpose mapped_semantic_purpose = 52;
    repeated ads.user_data_enforcement.DataUsage ads_processing_purpose = 7;
    optional Source ads_processing_purpose_source = 26;
    repeated .ptoken.PolicyRolloutEnforcementMode request_policy_rollout_enforcement_mode = 9;
    optional Source request_policy_rollout_enforcement_mode_source = 27;
    repeated PolicyBreakglass policies_breakglass = 10;
    optional Source policies_breakglass_source = 28;
    optional bool allow_enforcement_without_consent = 11;
    optional Source allow_enforcement_without_consent_source = 29;
    optional fixed32 source_pipeline_guri_hash = 14;
    optional Source source_pipeline_guri_hash_source = 30;
    optional Source origin_logical_location_source = 54;
    optional Source execution_id_source = 31;
    repeated .ptoken.LogicalPolicy.Enum request_policy_enforcement = 5;
    optional Source request_policy_enforcement_source = 32;
    repeated .ptoken.LogicalPolicy.Enum poe_enforced_return_policies = 33;
    optional Source poe_enforced_return_policies_source = 34;
    optional bool origin_is_end_user = 35;
    optional Source origin_is_end_user_source = 36;
    optional bool assistant_guest_mode_enabled = 37;
    optional Source assistant_guest_mode_enabled_source = 38;
    optional .ptoken.YoutubePrivacyEnhancedPlayerType youtube_privacy_enhanced_player_type = 39;
    optional Source youtube_privacy_enhanced_player_type_source = 40;
    optional bool youtube_autoplay_embedded_playback = 41;
    optional Source youtube_autoplay_embedded_playback_source = 42;
    optional bytes bitfield_value = 43;
    optional Source bitfield_value_source = 44;
    optional bytes bitfield_set = 45;
    optional Source bitfield_set_source = 46;
    optional .pattributes.SemanticPurpose semantic_purpose = 47;
    optional Source semantic_purpose_source = 48;
    repeated .pattributes.SemanticPurpose deferred_semantic_purposes = 49;
    optional Source deferred_semantic_purposes_source = 50;
    repeated data_governance.attributes.ProcessingPurpose.Purpose semantic_purpose_mapped_processing_purposes = 51;
    
    optional JlsDataCache jls_data_cache = 55;
    message JlsDataCache {
        optional data_flow.job_level_sensor.proto.PropagatedProductIdSetterMetadata product_id_setter_metadata = 1;
        optional fixed64 product_id_setter_metadata_fingerprint = 2;
        optional data_flow.job_level_sensor.proto.SemanticPurposeSetterMetadata semantic_purpose_setter_metadata = 3;
        optional fixed64 semantic_purpose_setter_metadata_fingerprint = 4;
    }
    
    oneof origin_logical_location {
        data_residency.mapping.cloud.CloudDataResidencyLocation origin_logical_cloud_location = 53;
    }
    
    oneof execution_id {
        int64 borg_run_uid = 15;
        int64 custom_execution_id = 17;
    }
}

message PrivacyContextDefaultTraceInfo {
    optional DefaultConfigurationInactiveReason inactive_reason = 1;
    enum DefaultConfigurationInactiveReason {
        REASON_UNSPECIFIED = 0;
        REASON_CONFIG_DISABLED_OR_ABSENT = 1;
        REASON_EXISTING_ORIGIN_PRODUCT_ID = 2;
        REASON_CONFIG_NO_MATCH = 3;
        REASON_INCOMING_RPC_CONTEXT = 4;
    }
    
    optional int32 existing_product_id = 2;
    
    extend .proto2.bridge.MessageSet {
        optional PrivacyContextDefaultTraceInfo message_set_extension = 495337008;
    }
}

message PrivacyContextDefaultTestConfig {
    optional bool test_mode = 1 [default = false];
    optional production.machine_locality.Host.Kind host_kind = 2 [default = UNKNOWN];
}

enum ConfigValidationErrors {
    VALIDATION_ERROR_UNSPECIFIED = 0;
    VALIDATION_ERROR_NO_PRODUCT_ID = 1;
    VALIDATION_ERROR_PRODUCT_ID_OUT_OF_RANGE = 2;
}
