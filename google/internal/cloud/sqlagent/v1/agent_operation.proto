syntax = "proto3";

package google.internal.cloud.sqlagent.v1;

import "storage/datapol/annotations/proto/semantic_annotations.proto";

option java_multiple_files = true;
option java_outer_classname = "AgentOperationProto";
option java_package = "com.google.internal.cloud.sqlagent.v1";

message OperationRequest {
    HttpMethod http_method = 2;
    string endpoint = 3;
    string payload = 4;
    OperationRequestKey operation_request_key = 5;
    
    reserved 1;
}

message OperationRequestKey {
    string operation_token = 1;
    string agent_operation_id = 2;
    string instance_name = 3;
    string instance_uid = 4;
}

message OperationResponse {
    int32 http_status = 2;
    string payload = 3;
    bytes obsolete_stdout = 4 [deprecated = true];
    bytes obsolete_stderr = 5 [deprecated = true];
    OperationRequestKey operation_request_key = 6;
    
    reserved 1;
}

message AgentHeartbeat {
    
}

message AgentResponse {
    string instance_name = 3;
    string sync_operation_id = 4;
    
    oneof message {
        OperationResponse operation_response = 1;
        AgentHeartbeat agent_heartbeat = 2;
    }
}

enum HttpMethod {
    UNKNOWN_HTTP_METHOD = 0;
    GET = 1;
    POST = 2;
    PUT = 3;
    DELETE = 4;
}

enum AgentType {
    UNKNOWN_AGENT = 0;
    SSL_BOOTSTRAP = 1;
    FLAGS = 2;
    FIREWALL = 3;
    SSL_INSERT = 4;
    SSL_DELETE = 5;
    CHECK_DATABASE_SERVER = 6;
    CREATE_USER = 7;
    DELETE_USER = 8;
    EXPORT = 10;
    IMPORT = 11;
    PROMOTE_REPLICA = 12;
    START_REPLICA = 13;
    STOP_REPLICA = 14;
    FAILOVER = 19;
    OS_SYNC = 20;
    PURGE_BINLOG = 21;
    SAVE_DATA = 22;
    LOAD_DATA = 23;
    DELETE_BINLOG = 24;
    RESIZE2FS = 25;
    STOP_UNIT = 27;
    RESTART_UNIT = 28;
    READ_BINLOG_POSITION = 29;
    APPLY_BINLOG = 30;
    LIST_USERS = 31;
    LIST_DATABASES = 32;
    CREATE_DATABASE = 35;
    CHECK_PROXY = 36;
    DELETE_DATABASE = 37;
    UPDATE_DATABASE = 38;
    UPDATE_USER = 39;
    CREATE_DATABASE_SYNC = 40;
    CREATE_USER_SYNC = 41;
    DELETE_USER_SYNC = 43;
    DEBUG = 44;
    GET_USER = 45;
    GET_DATABASE = 46;
    TRUNCATE_LOG_TABLE = 49;
    VERIFY_CONSISTENCY = 50;
    REPLICATION_SLOT = 51;
    UPDATE_ENFORCE_SSL_PREFERENCE = 53;
    EXPORT_AVRO = 55;
    VERIFY_BACKUP = 57;
    POSTGRES_START_BACKUP_BACKEND = 58;
    POSTGRES_START_BACKUP = 59;
    POSTGRES_STOP_BACKUP = 60;
    SETUP_PITR_RECOVERY = 61;
    CHECK_SERVICE_AGENTS = 62;
    WAIT_FOR_FILE = 63;
    VM_QUERY = 64;
    SHRINK_DISK = 65;
    DELETE_FILE = 66;
    EXTERNAL_MASTER_IMPORT = 67;
    PURE_OS_SYNC = 68;
    IMPORT_CSV = 69;
    EXPORT_CSV = 70;
    VERIFY_MIGRATION_SETTINGS = 71;
    SET_REPLICA = 72;
    STOP_DATABASE = 73;
    IMPORT_BAK = 74;
    PROVISION_INSTANCE = 75;
    SQLSERVER_UPDATE_RECOVERY_MODEL = 77;
    WAIT_ALMOST_CATCH_UP = 78;
    VERIFY_BINLOG = 79;
    EXPORT_BAK = 80;
    REFUSE_CONN_WAIT_FULLY_CATCH_UP = 81;
    START_BACKUP = 82;
    STOP_BACKUP = 83;
    REJECT_CONN = 85;
    IMPORT_DMP = 86;
    EXPORT_DMP = 87;
    UNIT_CTL = 88;
    PREPARE_ROLLOUT = 89;
    SETUP_LOGICAL_REPLICATION = 90;
    UPGRADE_CATALOG = 91;
    PURGE_ARCHIVED_WAL_FILE = 92;
    PHYSICAL_BACKUP = 93;
    PHYSICAL_RESTORE = 94;
    CHECK_ENVIRONMENT = 95;
    ENABLE_ACTIVE_DIRECTORY = 96;
    SUPPORTED_EXTENSIONS = 97;
    DISABLE_ACTIVE_DIRECTORY = 98;
    UPDATE_ACTIVE_DIRECTORY_ACCOUNT_PASSWORD = 99;
    CREATE_AG = 100;
    DROP_AVAILABILITY_GROUP = 101;
    PURGE_ACTIVE_DIRECTORY_ARTIFACTS = 102;
    REMOVE_REPLICA_ON_PRIMARY = 103;
    UPDATE_ACTIVE_DIRECTORY = 104;
    MAJOR_VERSION_UPGRADE = 105;
    CHECK_MAJOR_VERSION_UPGRADE_VIOLATION = 107;
    CREATE_ACTIVE_DIRECTORY_LOGIN = 108;
    CONNECTIVITY_PROBE = 109;
    REMOVE_REPLICATED_DATABASE = 110;
    RECOVER_AND_DELETE_DATABASE = 111;
    CHECK_REPLICATION = 112;
    REPAIR_ACTIVE_DIRECTORY_ACTION = 113;
    SETUP_REPLICA_CERT = 114;
    START_UNIT = 115;
    CHECK_DATA_DISK = 116;
    ENABLE_AUDIT = 117;
    MAJOR_VERSION_UPGRADE_IMAGE_DOWNLOAD = 118;
    FLUSH_OLD_DISK_LOGS = 119;
    PERFORM_PITR_RESTORE = 120;
    START_TRANSACTION_LOG_BACKUP = 121;
    STOP_TRANSACTION_LOG_BACKUP = 122;
    PREPARE_DATABASE_SNAPSHOT_BACKUP = 123;
    NOTIFY_DATADISK_SNAPSHOT_COMPLETION = 124;
    TAKE_DATABASE_OFFLINE_FOR_PITR = 125;
    PASSWORD_ENCRYPTION_SETUP = 126;
    GET_GCS_OBJECT_SIZE = 127;
    UPDATE_PITR_CONFIG = 128;
    UPGRADE_REPLICA = 129;
    SETUP_PITR_DATABASE_FILES = 130;
    UPDATE_TRANSACTION_LOG_RETENTION = 131;
    EXTERNAL_SERVER_PARALLEL_IMPORT = 132;
    GET_GCS_OBJECTS_WITH_PREFIX = 133;
    UPDATE_PITR_DATABASE_CONFIG = 134;
    INSTALL_PITR_DATABASE_STATE_UPDATES_EXTENDED_EVENT = 135;
    UNINSTALL_PITR_DATABASE_STATE_UPDATES_EXTENDED_EVENT = 136;
    VERIFY_BACKUP_LOGICAL_CHECK = 138;
    VALIDATE_DATABASES_FOR_FAILOVER = 139;
    ALTER_AVAILABILITY_MODE = 140;
    CHANGE_REPLICA_ROLE = 141;
    FAILOVER_TO_REPLICA = 142;
    HANDLE_DB_CACHE = 143;
    UPDATE_READ_MODE = 144;
    WAIT_FOR_REPLICA_TO_CATCHUP_WITH_PRIMARY = 145;
    IMPORT_USER_FILE = 146;
    EXPORT_USER_FILE = 147;
    LIST_USER_FILES = 148;
    DELETE_USER_FILE = 149;
    COMPARE_FILE_CHECKSUMS = 150;
    VERIFY_BACKUP_UNDO_LOG_PURGE = 154;
    PREPARE_DISK = 155;
    CREATE_SECONDARY_AG = 156;
    ADD_AG_LISTENER = 157;
    CREATE_DISTRIBUTED_AG = 158;
    JOIN_DISTRIBUTED_AG = 159;
    UPDATE_PASSWORD_ENCRYPTION_CONFIG = 160;
    REMOVE_REPLICA_ON_FORWARDER = 161;
    REMOVE_FORWARDER = 162;
    REMOVE_REPLICA_METADATA_FROM_PRIMARY = 163;
    REMOVE_REPLICA_METADATA_FROM_FORWARDER = 164;
    SWITCHOVER_TO_SHADOW_VM = 165;
    EXTERNAL_SERVER_PHYSICAL_MIGRATION = 166;
    EXPORT_SHELL = 167;
    PREPARE_PITR_LOGS = 168;
    IMPORT_SHELL = 169;
    VERIFY_AFTER_SWITCHOVER = 170;
    SETUP_HEALTHCHECK_GRPC_FIREWALL = 171;
    REJECT_DB_TRAFFIC = 172;
    UNMOUNT_GCS_DOWNLOAD_DISK = 173;
    OVERRIDE_HEALTHCHECK = 174;
    PURGE_SQLSERVER_TLOG_BACKUP = 175;
    RESET_VM_ON_FAILURE = 176;
    CHECK_MARKER_FILE = 177;
    EXECUTE_SQL = 178;
    START_FAILOVER_CRON_JOB = 179;
    UPDATE_READ_REPLICA_METADATA = 180;
    STOP_FAILOVER_CRON_JOB = 181;
    CLEAN_UP_PITR_FILES = 182;
    CLEANUP_TUNNEL_RESOURCES = 183;
    ACQUIRE_SSRS_LEASE = 184;
    RESTORE_DATABASE = 185;
    RELEASE_SSRS_LEASE = 186;
    DOWNLOAD_LOGS_FROM_GCS = 187;
    TURN_OFF_HADR_IN_FORWARDER = 188;
    MOUNT_BINLOG_DISK = 189;
    UNMOUNT_BINLOG_DISK = 190;
    IMPORT_DIRECTORY = 191;
    DROP_ALL_AVAILABILITY_GROUPS = 192;
    EXPORT_DIRECTORY = 193;
    SCAN_AND_ARCHIVE_BINLOG = 194;
    SET_RECOVERY_MODE = 195;
    UPDATE_REPLICATION_PORT_BLOCK = 196;
    WAIT_FOR_POSTGRES_PITR_STATUS = 197;
    MANAGE_DATA_DISK_RESERVATION = 198;
    FLUSH_BINLOG_AND_WAIT_PITR = 199;
    CHECK_DATABASE_NEVER_STARTED = 200;
    UPDATE_PITR_DATABASE_FILES_PERMISSION = 201;
    EXPORT_TEXT_LINES = 202;
    LIST_EXTERNAL_SOURCE_OBJECTS = 203;
    IMPORT_TDE = 204;
    FORCE_CHECKPOINT = 205;
    EXPORT_TDE = 206;
    SET_HOT_STANDBY_MODE = 207;
    SWITCH_WAL_FILE = 208;
    CHANGE_TIMEZONE = 209;
    UNBLOCK_DB_TRAFFIC = 210;
    WAIT_WAL_FILE_ARCHIVAL_TO_GCS = 211;
    UPDATE_INSIGHTS_CONFIG = 212;
    UPDATE_PGBOUNCER_CONFIG = 213;
    REVERT_HOT_STANDBY_MODE = 214;
    CHECK_PGBOUNCER = 215;
    RECOVER_DATABASES = 216;
    TAKE_LOG_BACKUP = 217;
    CHECK_ZDT_ELIGIBILITY = 218;
    MANAGE_INSTANCE_PERMISSIONS = 219;
    VERIFY_REPLICATION_STATUS = 220;
    POST_SWITCHOVER_PREP_INSTANCE_CLEANUP = 221;
    VALIDATE_SQL = 222;
    MYSQL_MAJOR_VERSION_UPGRADE = 223;
}
