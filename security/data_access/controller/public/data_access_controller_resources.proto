syntax = "editions";

package security.data_access;

import "google/protobuf/any.proto";
import "net/proto2/proto/descriptor.proto";
import "security/data_access/controller/public/http_request.proto";

option java_multiple_files = true;
option java_package = "com.google.security.data_access.controller.client";

message ControllerAuditing {
    repeated ControllerAuditingRule rules = 1;
    map<string, string> labels = 2;
}

message ControllerAuditingRule {
    optional string selector = 1;
    optional string directive = 2;
}

message PackagedProto {
    optional google.protobuf.Any contents = 1;
    optional .proto2.FileDescriptorSet descriptors = 2 [lazy = true];
}

message HttpExtractionRules {
    repeated HttpResourceRule resources = 1;
    repeated HttpReasonRule reasons = 2;
    repeated HttpQueryRule queries = 3;
}

message HttpResourceRule {
    optional HttpFieldSelector selector = 1;
    optional string resource_registry_type = 2;
}

message HttpReasonRule {
    optional HttpFieldSelector selector = 1;
}

message HttpQueryRule {
    optional HttpFieldSelector selector = 1;
}

message HttpFieldSelector {
    oneof source {
        string header = 1;
        string param = 2;
    }
}

message FrisResourceId {
    optional string path = 1;
    optional string value = 2;
}

message FrisResourceParams {
    optional PackagedProto resource_type_proto = 1;
    repeated FrisResourceId resource_ids = 2;
}

message HttpPackagedProto {
    optional HttpRequest request = 1;
    optional HttpExtractionRules http_extraction_rules = 2;
    optional PackagedProto request_proto = 3;
    optional FrisResourceParams resource_params = 4;
}
