syntax = "proto2";

package automation.errors;

import "google/api/inclusion.proto";
import "google/protobuf/any.proto";
import "google/protobuf/timestamp.proto";
import "java/com/google/apps/jspb/jspb_generate_object_format.proto";
import "net/proto2/bridge/proto/message_set.proto";
import "util/task/codes.proto";

option java_package = "com.google.protos.automation.errors.proto1api";

message SpaceCode {
    optional int32 code = 1;
    optional string space = 2;
}

message TaskIdentity {
    optional string bns_address = 1;
    optional string host_address = 2;
    repeated int32 host_port = 3;
    optional string binary_path = 4;
    optional string workflow_id = 5;
    
    optional CallMechanism mechanism = 6;
    enum CallMechanism {
        UNKNOWN_CALL_MECHANISM = 0;
        COMMAND_LINE = 1;
        RPC = 2;
        ACTUATOR = 3;
        CONTROL = 4;
    }
    
    optional string rpc_method = 11;
    optional .google.protobuf.Any input = 7;
    repeated string argv = 8 [deprecated = true];
    optional string cwd = 9;
    optional int64 pid = 10;
}

message SourceInfo {
    optional string file = 1;
    optional int64 line = 2;
    optional int64 changelist = 3;
    optional bool modified = 4;
    optional string build_label = 5;
}

message Link {
    optional string url = 1;
    optional string type = 2;
}

message Error {
    optional TaskIdentity identity = 1;
    optional util.error.Code code = 2 [default = UNKNOWN];
    optional string summary = 3;
    optional string message = 4;
    optional string markdown_message = 12;
    optional .google.protobuf.Timestamp timestamp = 5;
    optional SourceInfo source_info = 6;
    repeated Error causes = 7;
    repeated Link links = 8;
    map<string, string> variables = 9;
    optional .google.protobuf.Any details = 10;
    optional SpaceCode space_code = 11;
    optional SignalLog signals = 13;
    repeated int32 error_ids = 14 [packed = true];
    optional string error_id_string = 15;
    
    extend .proto2.bridge.MessageSet {
        optional Error message_set_extension = 97315663;
    }
}

message SignalLog {
    optional ComponentSignal component = 1;
    optional CategorySignal category = 2;
    repeated KnownIssueSignal known_issues = 3;
    optional TPCFailureSignal tpc_failure = 4;
}

message ComponentSignal {
    optional Component component = 1;
    enum Component {
        UNKNOWN = 0;
        DRIVER = 1;
        STRATEGIST = 2;
        ENFORCER = 3;
        CAS = 4;
        ANNEALING_ROUTER = 5;
        ASPECTSTORE = 6;
        ROS = 7;
        PRODSPEC = 8;
        TARGET_SELECTION = 9;
        LOCKING_SERVER = 10;
        PLUGIN_UNKNOWN = 100;
        PLUGIN_BORG = 101;
        PLUGIN_GSLB = 102;
        PLUGIN_CDPUSH = 103;
        PLUGIN_FLEXALL = 104;
        PLUGIN_GANPATI = 105;
        PLUGIN_PLINY = 106;
        PLUGIN_ANNEALING_MPM_TPC_REPLICATION_ASSET = 107;
        PLUGIN_EXTERNAL_MEMBERSHIPS = 108;
        PLUGIN_API_CONTROL_PLANE = 109;
        PLUGIN_SPANNER = 110;
        PLUGIN_MONARCH = 111;
        PLUGIN_BOUNCER = 112;
        PLUGIN_REMOTE_DIFF = 113;
        PLUGIN_COLOSSUSPATH = 114;
        PLUGIN_CHUBBYPATH = 115;
        PLUGIN_QUOTA_SERVER = 116;
        DEP_UNKNOWN = 200;
        DEP_PIPER = 201;
        DEP_AUTOCAP = 202;
        DEP_CDPUSH = 203;
        DEP_SERVER_PLATFORM = 204;
        DEP_BOUNDARY_PROXY = 205;
        DEP_POD_SPANNER = 206;
        DEP_BOQ_LRO = 207;
        DEP_PLUGIN_SEQUENCER = 208;
        PLUGIN_GCCP = 300;
        PLUGIN_ERROR_ACTION = 301;
        PLUGIN_ACL_ZANZIBAR_QUOTA = 400;
        PLUGIN_ACPA = 401;
        PLUGIN_ANDORRA_SPANNER = 402;
        PLUGIN_APPENGINE = 403;
        PLUGIN_AUTOALERTROUTE = 404;
        PLUGIN_AUTOLEAF = 405;
        PLUGIN_AUTOPILOT = 406;
        PLUGIN_BASIC_CONFIG_SHARD = 407;
        PLUGIN_BBMC = 408;
        PLUGIN_BLOKUSCELL = 409;
        PLUGIN_BOQ_NODE = 410;
        PLUGIN_BORGCRON = 411;
        PLUGIN_BTSPEC = 412;
        PLUGIN_BUGANIZER = 413;
        PLUGIN_CAPABILITIES = 414;
        PLUGIN_CONFIG_FILE = 415;
        PLUGIN_CONDUIT_FLUME_PIPELINES = 416;
        PLUGIN_CONDUIT_LEAF_FILES = 417;
        PLUGIN_CONDUIT_WORKGRAPH = 418;
        PLUGIN_DAASCONFIG = 419;
        PLUGIN_DEDICATED_MACHINES = 420;
        PLUGIN_DREAMPIPE = 421;
        PLUGIN_ELECTEDSET = 422;
        PLUGIN_FILE_NAMESPACE = 423;
        PLUGIN_FIRMWARE_DEVICES = 424;
        PLUGIN_G3TERRAFORM = 425;
        PLUGIN_GANPATICFG = 426;
        PLUGIN_GLINDA = 427;
        PLUGIN_GSLB_INVERTED = 428;
        PLUGIN_GSTCONFIG = 429;
        PLUGIN_HAMILTON = 430;
        PLUGIN_IPDB = 431;
        PLUGIN_JOBCHECKER = 432;
        PLUGIN_KUBERNETES = 433;
        PLUGIN_LIGHTWAVE = 434;
        PLUGIN_MACSERVICE = 435;
        PLUGIN_MANUAL_MOVE_ACTION = 436;
        PLUGIN_MBNS_ENROLL = 437;
        PLUGIN_MENHIR = 438;
        PLUGIN_METAMON = 439;
        PLUGIN_MILLWHEEL_CELL = 440;
        PLUGIN_MILLWHEEL_PIPELINE = 441;
        PLUGIN_MONARCH_CANARY = 442;
        PLUGIN_MPM_LABEL = 443;
        PLUGIN_MSTAGES = 444;
        PLUGIN_MUPPET_TREE = 445;
        PLUGIN_NAME_SERVICE = 446;
        PLUGIN_NETROV = 447;
        PLUGIN_NETWORK_CONTROL = 448;
        PLUGIN_NETWORK_SWITCH = 449;
        PLUGIN_NETWORKFLOWGROUP = 450;
        PLUGIN_NETWORKTEDOMAIN = 451;
        PLUGIN_NODE = 452;
        PLUGIN_ONERPC = 453;
        PLUGIN_OUTBOUNDACL = 454;
        PLUGIN_PANTHEON = 455;
        PLUGIN_PATH = 456;
        PLUGIN_PLACER = 457;
        PLUGIN_PLX = 458;
        PLUGIN_POLEARM = 459;
        PLUGIN_PROBER_SERVICE = 460;
        PLUGIN_PUBSUB2 = 461;
        PLUGIN_PUSH_CONFIG = 462;
        PLUGIN_REMOTE_BORG_ENVIRONMENT = 463;
        PLUGIN_REMOTE_BORG_JOB = 464;
        PLUGIN_REMOTE_SPANNER_DATABASE = 465;
        PLUGIN_RIGGING = 466;
        PLUGIN_SEQUENCER = 467;
        PLUGIN_SERVOMATIC = 468;
        PLUGIN_SILKROADS = 469;
        PLUGIN_SLM = 470;
        PLUGIN_SPANNER_DATABASE_PLACEMENT = 471;
        PLUGIN_SPANNER_SCHEMA_ROLLOUT = 472;
        PLUGIN_SPANNERJOB = 473;
        PLUGIN_SPLANNER = 474;
        PLUGIN_SQL_PIPELINES = 475;
        PLUGIN_STREAMING_FLUME = 476;
        PLUGIN_STUBBYTEE_CONFIGURATION = 477;
        PLUGIN_TECH_LOCK_INSTANCE = 478;
        PLUGIN_TERRAFORM = 479;
        PLUGIN_TF_HUB = 480;
        PLUGIN_TURBINE_PIPELINE = 481;
        PLUGIN_UNION = 482;
        PLUGIN_UNISERVE = 483;
        PLUGIN_VERTEX = 484;
        PLUGIN_WARPPLANE = 485;
        PLUGIN_SINK = 486;
        PLUGIN_BUGANIZER_CHECK = 487;
        PLUGIN_GSLB_LEGACY = 488;
        OTHER_COMPONENT = 1000;
    }
}

message CategorySignal {
    optional Category category = 1;
    enum Category {
        UNSPECIFIED = 0;
        SYSTEM = 1;
        USER = 2;
        SAFETY = 3;
        DEPENDENCY = 4;
        OTHER = 100;
    }
    
    optional bool is_heuristic = 2;
}

message KnownIssueSignal {
    optional string link = 1;
}

message TPCFailureSignal {
    optional string universe = 1;
}
